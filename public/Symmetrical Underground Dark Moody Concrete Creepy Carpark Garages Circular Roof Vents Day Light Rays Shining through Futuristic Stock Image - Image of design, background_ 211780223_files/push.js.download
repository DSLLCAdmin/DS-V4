var push={init:function(){if(location.hostname!='www.dreamstime.com'&&!location.href.match(/wpn=1/)){return}
if(location.pathname&&location.pathname.match(/^\/upload/)){return}
push.load(['https://www.gstatic.com/firebasejs/11.0.1/firebase-app-compat.js','https://www.gstatic.com/firebasejs/11.0.1/firebase-messaging-compat.js']).then(function(){push.start()})},appendScript:function(url,resolve,reject){var element=document.createElement('script');var parent='body';var attr='src';element.onload=function(){resolve(url)};element.onerror=function(){reject(url)};element.async=!0;element[attr]=url;document[parent].appendChild(element)},load:function(url){if(typeof url=="object"&&'forEach' in url){var sequence=Promise.resolve();url.forEach(function(url){sequence=sequence.then(function(){return push.load(url)})});return sequence}
return new Promise(function(resolve,reject){push.appendScript(url,resolve,reject)})},start:function(){var config={apiKey:"AIzaSyAGwgC_UOOaJvncyE9oWRPhzA9qrXc68Bk",authDomain:"acoustic-patrol-174809.firebaseapp.com",databaseURL:"https://acoustic-patrol-174809.firebaseio.com",projectId:"acoustic-patrol-174809",storageBucket:"acoustic-patrol-174809.firebasestorage.app",messagingSenderId:"716229567248",appId:"1:716229567248:web:ecb2b81c05098d4473bb95"};firebase.initializeApp(config);push.messaging=firebase.messaging();push.messaging.getToken({vapidKey:'BKRn1X6SkyHFCuNA3bsQBBAQNll5SxOLVlUOOAfQCkadxlrs6ho7fe3CHpdzZJPVOgd2nrooLfsslbZpT7cxfHg'}).then(function(refreshedToken){push.sendTokenToServer(refreshedToken)}).catch(function(err){});if(!push.incomingInited){push.incomingInited=!0;push.messaging.onMessage(function(payload){try{var title=payload.data.title;var options={body:payload.data.body,icon:payload.data.icon,image:payload.data.image,data:{click_action:payload.data.click_action},tag:title+payload.data.click_action,requireInteraction:!0,renotify:!0};try{options.actions=JSON.parse(payload.data.actions);options.data.click_actions=JSON.parse(payload.data.click_actions)}catch(err){}
console.log("Incoming notification:",title,options)}catch(err){}})}},pushInit:function(){push.messaging.getToken().then(function(currentToken){if(currentToken){push.sendTokenToServer(currentToken)}else{push.setTokenSentToServer('')}}).catch(function(err){push.setTokenSentToServer('')})},sendTokenToServer:function(currentToken){if(!push.isTokenSentToServer(currentToken)){push.saveToken(currentToken)}},isTokenSentToServer:function(token){return window.localStorage.getItem('tokenSentToServer')===token},setTokenSentToServer:function(token){window.localStorage.setItem('tokenSentToServer',token)},requestPermission:function(){if(typeof show_wpn=="undefined"||!show_wpn){return}
Notification.requestPermission().then(function(permission){if(permission==='granted'){push.pushInit()}})},saveToken:function(token){var formData=new FormData();formData.append('token',token);formData.append('securitycheck',securitycheck);fetch("/ajax/push.php",{method:"POST",body:formData}).then(function(result){if(result&&result.ok){result.text().then(function(result){push.onSaveToken(token,result==='true')})}})},onSaveToken:function(token,result){if(result){push.setTokenSentToServer(token)}}};push.init()